<app-header></app-header>

<ion-content class="ion-padding">

  <div id="calendar" class="calendar-container">
    <ion-datetime
      presentation="date"
      locale="es-ES"
      [firstDayOfWeek]="1"
      size="cover"
      [value]="fechaSeleccionada"
      (ionChange)="onFechaChange($event)"
      [highlightedDates]="highlightedDates"
    ></ion-datetime>
  </div>

  <div id="eventos" class="eventos-container">
    <ion-list lines="none" style="background: transparent;">

      <ion-card
        *ngFor="let evento of eventos"
        class="evento-card"
        [class]="'estado-' + evento.estado"
        [hidden]="esEventoPasado(evento)">

        <ion-item lines="none" class="evento-content">
          <ion-icon name="calendar-outline" slot="start" color="medium"></ion-icon>
          <ion-label>
            <h2>{{ evento.titulo }}</h2>
            <p>{{ evento.fecha | date:'dd/MM/yyyy' }} • {{ evento.hora }}</p>
            <p class="estado">
              <ion-badge [color]="getColorEstado(evento.estado)">{{ evento.estado }}</ion-badge>
            </p>
          </ion-label>
          <ion-button slot="end" fill="clear" color="danger" (click)="eliminarEvento(evento)">
            <ion-icon name="trash-outline"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-card>

      <ion-item *ngIf="eventos.length === 0" class="sin-eventos">
        <ion-label class="ion-text-center">
          <p>No hay eventos aún. ¡Crea el primero!</p>
        </ion-label>
      </ion-item>
    </ion-list>
  </div>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button color="primary" id="open-modal" expand="block">
      <ion-icon name="add-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  <ion-modal #modal trigger="open-modal">
    <ng-template>
      <ion-content>
        <ion-toolbar class="gradient-toolbar">
          <ion-title>Crear evento</ion-title>
          <ion-buttons slot="end">
            <ion-button color="light" (click)="modal.dismiss()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
        <ion-card>
          <ion-card-content class="ion-padding">

            <ion-item>
              <ion-input
                [(ngModel)]="evento.titulo"
                label="Título: "
                label-placement="floating"
                placeholder="Introduce el título">
              </ion-input>
            </ion-item>

            <ion-item lines="none">
              <ion-label>Fecha:</ion-label>
              <ion-datetime-button datetime="datetime"></ion-datetime-button>
              <ion-modal [keepContentsMounted]="true">
                <ng-template>
                  <ion-datetime
                    id="datetime"
                    locale="es-ES"
                    presentation="date-time">
                  </ion-datetime>
                </ng-template>
              </ion-modal>
            </ion-item>
            <ion-item>
              <ion-input
                label="Lugar:"
                label-placement="floating"
                placeholder="Introduce el lugar">
              </ion-input>
            </ion-item>
            <ion-item>
              <ion-textarea
                label="Descripción:"
                labelPlacement="floating"
                placeholder="Descripción del evento"
                [autoGrow]="true">
              </ion-textarea>
            </ion-item>
            <ion-item lines="none">
              <ion-label position="stacked">Imagen del evento</ion-label>
              <div class="image-upload-container" (click)="fileInput.click()">
                <input #fileInput type="file" accept="image/*" (change)="onImagenChange($event)" hidden />
                <div class="image-preview">
                  <div class="overlay">
                    <ion-icon name="camera-outline" size="large"></ion-icon>
                    <span>Subir foto</span>
                  </div>
                </div>
              </div>
            </ion-item>
            <ion-button expand="block" color="primary" (click)="agregarEvento()">
              <ion-icon name="save-outline" slot="start"></ion-icon>
              Guardar Evento
            </ion-button>

          </ion-card-content>
        </ion-card>
      </ion-content>
    </ng-template>
  </ion-modal>
  <ion-toast
    #toastError
    message="El título del evento es obligatorio"
    color="danger"
    duration="3000"
    position="top"
    [buttons]="[
    {
      text: 'OK',
      role: 'cancel'
    }
  ]">
  </ion-toast>

</ion-content>

<app-footer></app-footer>
